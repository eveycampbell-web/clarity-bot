import os, json, random, logging
from pathlib import Path
from datetime import datetime, timedelta
from aiogram import Bot, Dispatcher, types
from aiogram.utils import executor
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
from dotenv import load_dotenv

# ‚îÄ‚îÄ –õ–û–ì–ò, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
logging.basicConfig(level=logging.INFO)

# ‚îÄ‚îÄ –ù–ê–î–Å–ñ–ù–ê–Ø –∑–∞–≥—Ä—É–∑–∫–∞ .env –∏–∑ —Ç–æ–π –∂–µ –ø–∞–ø–∫–∏, —á—Ç–æ bot.py ‚îÄ‚îÄ‚îÄ
BASE_DIR = Path(__file__).resolve().parent
load_dotenv(dotenv_path=BASE_DIR / ".env")

TOKEN = os.getenv("BOT_TOKEN")
CHANNEL_LINK = os.getenv("TELEGRAM_CHANNEL_LINK", "https://t.me/your_channel")
OWNER_USERNAME = os.getenv("OWNER_USERNAME", "@your_username")
USAGE_FILE = BASE_DIR / "usage.json"  # –ø–∏—à–µ–º —Ä—è–¥–æ–º —Å bot.py

if not TOKEN:
    raise RuntimeError("–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞. –û—Ç–∫—Ä–æ–π—Ç–µ .env –∏ –ø—Ä–æ–ø–∏—à–∏—Ç–µ BOT_TOKEN=...")

# ‚îÄ‚îÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞: —É–≤–µ–ª–∏—á–∏–º —Ç–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# (–µ—Å–ª–∏ —Å–µ—Ç—å ¬´—Ç—è–∂—ë–ª–∞—è¬ª, –±—É–¥–µ—Ç —Ç–µ—Ä–ø–∏–º–µ–µ)
bot = Bot(token=TOKEN, parse_mode="HTML", timeout=120)
dp = Dispatcher(bot)

# ‚îÄ‚îÄ –ï–î–ò–ù–´–ï –¢–ï–ö–°–¢–´ –∏ –¥–∏—Å–∫–ª–µ–π–º–µ—Ä—ã (18+) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
WELCOME = (
    "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –±–æ—Ç ¬´–ö–∞—Ä—Ç–∞ —è—Å–Ω–æ—Å—Ç–∏¬ª ‚ú®\n\n"
    "–ù–∞–∂–º–∏ ¬´–ú–æ—è —Ç–µ–º–∞¬ª ‚Üí –≤—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ —Ç—ë—Ä—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí –≤—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç—É –∏ –ø–æ–ª—É—á–∏ –º—è–≥–∫—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. "
    "–û–¥–Ω–∞ –∫–∞—Ä—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ <b>—Ä–∞–∑ –≤ 7 –¥–Ω–µ–π</b>, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç—Ä–µ–∑–≤—ã–π –≤–∑–≥–ª—è–¥ –∏ –ø–æ–ª—å–∑—É.\n\n"
    "–í–∞–∂–Ω–æ: –±–æ—Ç –Ω–æ—Å–∏—Ç —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∏ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∏–ª–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π. <b>18+</b>"
)

HELP_TEXT = (
    "–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:\n"
    "‚Ä¢ –ù–∞–∂–º–∏ ¬´–ú–æ—è —Ç–µ–º–∞¬ª –∏ –≤—ã–±–µ—Ä–∏: ¬´–ß—Ç–æ –æ–Ω(–∞) –¥—É–º–∞–µ—Ç –æ–±–æ –º–Ω–µ?¬ª, ¬´–ö–∞–∫ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ?¬ª, ¬´–ú–æ–π —Å–∫—Ä—ã—Ç—ã–π —Ç–∞–ª–∞–Ω—Ç¬ª.\n"
    "‚Ä¢ –í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç—É 1‚Äì5 –∏–ª–∏ ¬´üé≤ –°–ª—É—á–∞–π–Ω–æ¬ª.\n"
    "‚Ä¢ –ü—Ä–æ—á–∏—Ç–∞–π –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç, —Å–¥–µ–ª–∞–π –ø—Ä–æ—Å—Ç–æ–π —à–∞–≥ ‚Äî –∏ –∑–∞–∫—Ä–µ–ø–∏ —è—Å–Ω–æ—Å—Ç—å.\n\n"
    f"–ö–∞–Ω–∞–ª: {CHANNEL_LINK}\n–°–≤—è–∑—å: {OWNER_USERNAME}\n\n"
    "–î–∏—Å–∫–ª–µ–π–º–µ—Ä: –±–æ—Ç –Ω–æ—Å–∏—Ç —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∏ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∏–ª–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π. <b>18+</b>"
)

PRIVACY_TEXT = (
    "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:\n"
    "‚Äî –ë–æ—Ç –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É.\n"
    "‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞, –∫–æ–≥–¥–∞ –≤—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –ø–æ–ª—É—á–∞–ª–∏ ¬´–ö–∞—Ä—Ç—É —è—Å–Ω–æ—Å—Ç–∏¬ª (—á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞–ª –∑–∞–º–æ–∫ –Ω–∞ 7 –¥–Ω–µ–π).\n"
    "‚Äî –•–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ –≤ –ª–∏—á–∫—É.\n\n"
    "–î–∏—Å–∫–ª–µ–π–º–µ—Ä: –±–æ—Ç –Ω–æ—Å–∏—Ç —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π –∏ –ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∏–ª–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–µ–π. <b>18+</b>"
)

CTA_TAIL = (
    f"\n\n–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –Ω–∞ –∫–∞–Ω–∞–ª: {CHANNEL_LINK}\n\n"
    f"üéÅ –ù–∞–ø–∏—à–∏ —Å–ª–æ–≤–æ ¬´–Ø–°–ù–û–°–¢–¨¬ª –≤ –ø—Ä–æ—Ñ–∏–ª—å {OWNER_USERNAME} ‚Äî –∏ –ø–æ–ª—É—á–∏ —Å–∫–∏–¥–∫—É <b>50%</b> –Ω–∞ –ø–µ—Ä–≤—ã–π —Ä–∞–∑–±–æ—Ä. –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. <b>18+</b>"
)

LOCK_TEXT = (
    "¬´–ö–∞—Ä—Ç–∞ —è—Å–Ω–æ—Å—Ç–∏¬ª –¥–æ—Å—Ç—É–ø–Ω–∞ <b>1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</b> ‚Äî —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ü–∏–∫–ª–∏—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–Ω–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–æ–≥–æ –≤–∑–≥–ª—è–¥–∞. "
    "–ü–æ–∫–∞ –∏–¥—ë—Ç –æ–∂–∏–¥–∞–Ω–∏–µ, –≤ –∫–∞–Ω–∞–ª–µ —Ç–µ–±—è —É–∂–µ –∂–¥—É—Ç —Ä–∞—Å–∫–ª–∞–¥—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ä–∞–∑–±–æ—Ä—ã ‚Äî –æ–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç –¥–µ—Ä–∂–∞—Ç—å –∫—É—Ä—Å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.\n\n"
    f"–ó–∞–≥–ª—è–Ω–∏: {CHANNEL_LINK}\n\n"
    f"üéÅ –ù–µ —Ö–æ—á–µ—à—å –∂–¥–∞—Ç—å –∏ –Ω—É–∂–µ–Ω –ª–∏—á–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Å–æ <b>—Å–∫–∏–¥–∫–æ–π 50%</b>? –ù–∞–ø–∏—à–∏ —Å–ª–æ–≤–æ ¬´–Ø–°–ù–û–°–¢–¨¬ª –≤ –ø—Ä–æ—Ñ–∏–ª—å {OWNER_USERNAME}. –°–∫–∏–¥–∫–∞ 50% –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. <b>18+</b>"
)

ABOUT_TEXT = (
    "–§–æ—Ä–º–∞—Ç—ã: –¢–∞—Ä–æ / –ù—É–º–µ—Ä–æ–ª–æ–≥–∏—è / –ê—Å—Ç—Ä–æ–ª–æ–≥–∏—è ‚Äî —Ñ–æ–∫—É—Å –Ω–∞ —Ç–≤–æ–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.\n"
    "–ß—Ç–æ –ø–æ–ª—É—á–∏—à—å: —á–µ—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤—Å–µ –≤–æ–ª–Ω—É—é—â–∏–µ —Ç–µ–±—è –≤–æ–ø—Ä–æ—Å—ã. –Ø —Ä—è–¥–æ–º, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å —É—Å–ª—ã—à–∞—Ç—å, –∫–∞–∫ —Ö–æ—á–µ—à—å –∂–∏—Ç—å –∏–º–µ–Ω–Ω–æ —Ç—ã üíö.\n\n"
    f"üí¨ –ù–∞–ø–∏—à–∏ ¬´–Ø–°–ù–û–°–¢–¨¬ª {OWNER_USERNAME} ‚Äî –ø–æ–¥—Å–∫–∞–∂—É —Ñ–æ—Ä–º–∞—Ç –∏ –≤—Ä–µ–º—è. <b>18+</b>"
)

TOPIC_LABELS = {
    "think": "–ß—Ç–æ –æ–Ω(–∞) –¥—É–º–∞–µ—Ç –æ–±–æ –º–Ω–µ?",
    "money": "–ö–∞–∫ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ?",
    "talent": "–ú–æ–π —Å–∫—Ä—ã—Ç—ã–π —Ç–∞–ª–∞–Ω—Ç",
}

TEXTS = {
    "think": {
        "1": (
            "<b>–û—Ç–≤–µ—Ç:</b> –∏–Ω—Ç–µ—Ä–µ—Å –µ—Å—Ç—å, –Ω–æ —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–æ—Ä–æ–∂–Ω–∏—á–∞–µ—Ç. üòä\n"
            "<b>–®–∞–≥:</b> —Å–¥–µ–ª–∞–π –ª—ë–≥–∫–∏–π –∫–æ–Ω—Ç–∞–∫—Ç –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è: –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–ö–∞–∫ —Ç—ã?¬ª ‚Äî –±–µ–∑ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ ¬´–∫—Ç–æ –º—ã¬ª.\n"
            "¬´–ö–æ–≥–¥–∞ —Ä—è–¥–æ–º —Å–ø–æ–∫–æ–π–Ω–æ ‚Äî —á—É–≤—Å—Ç–≤–∞ —Å–∞–º–∏ –≤—ã–±–∏—Ä–∞—é—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è.¬ª"
        ),
        "2": (
            "<b>–û—Ç–≤–µ—Ç:</b> –≤–∏–¥–∏—Ç –≤ —Ç–µ–±–µ –æ–ø–æ—Ä—É, –Ω–æ –±–æ–∏—Ç—Å—è —Ä–∞—Å–∫—Ä—ã—Ç—å—Å—è. üíõ\n"
            "<b>–®–∞–≥:</b> —Å–∫–∞–∂–∏ –∏–ª–∏ –Ω–∞–ø–∏—à–∏: ¬´–ú–Ω–µ —Ç–µ–ø–ª–æ, –∫–æ–≥–¥–∞ –º—ã –æ–±—â–∞–µ–º—Å—è —á–∞—â–µ¬ª –∏ –ø–æ—Å–ª–µ –ø—Ä–µ–¥–ª–æ–∂–∏ –ø—Ä–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –≤–¥–≤–æ—ë–º.¬ª\n"
            "¬´–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–≤–µ—Ä–∏ –º—è–≥—á–µ –ª—é–±—ã—Ö —Å–ª–æ–≤.¬ª"
        ),
        "3": (
            "<b>–û—Ç–≤–µ—Ç:</b> —Å–∏–º–ø–∞—Ç–∏—è –µ—Å—Ç—å, –Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç—Å—è. ü§î\n"
            "<b>–®–∞–≥:</b> –∑–∞–ø–∏—à–∏ 3 —Ñ–∞–∫—Ç–∞ —Å–≤–æ–µ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–µ–ª–∞, –∞ –Ω–µ —è—Ä–ª—ã–∫–∏) –∏ –ø—Ä–æ—è–≤–∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±—â–µ–Ω–∏–∏.\n"
            "¬´–Ø—Å–Ω–æ—Å—Ç—å –æ —Å–µ–±–µ –¥–µ–ª–∞–µ—Ç —á—É–∂–∏–µ —Å–æ–º–Ω–µ–Ω–∏—è —Ç–∏—à–µ.¬ª"
        ),
        "4": (
            "<b>–û—Ç–≤–µ—Ç:</b> –≤–æ—Å—Ö–∏—â–∞–µ—Ç—Å—è —Ç–≤–æ–µ–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, –±–æ–∏—Ç—Å—è ¬´–Ω–µ –¥–æ—Ç—è–Ω—É—Ç—å¬ª. ‚ú®\n"
            "<b>–®–∞–≥:</b> –ø–æ–ø—Ä–æ—Å–∏ –æ –º–∞–ª–µ–Ω—å–∫–æ–π –ø–æ–º–æ—â–∏ –ø–æ –¥–µ–ª—É: ¬´–ü–æ–¥—Å–∫–∞–∂–µ—à—å, –∫–∞–∫ –≤—ã–±—Ä–∞—Ç—å‚Ä¶?¬ª ‚Äî —ç—Ç–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏—é.\n"
            "¬´–°–∏–ª–∞ –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤ –Ω–µ–π –µ—Å—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ.¬ª"
        ),
        "5": (
            "<b>–û—Ç–≤–µ—Ç:</b> —á—É–≤—Å—Ç–≤–∞ –µ—Å—Ç—å, –Ω–æ —Å–µ–π—á–∞—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω(-–∞) –¥–µ–ª–∞–º–∏. üåßÔ∏è\n"
            "<b>–®–∞–≥:</b> –≤—ã–±–µ—Ä–∏ —Ñ–æ—Ä–º–∞—Ç ¬´–ª—ë–≥–∫–∏–π –∫–æ–Ω—Ç–∞–∫—Ç 48 —á–∞—Å–æ–≤¬ª: –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç—ë–ø–ª—ã–µ –∫–∞—Å–∞–Ω–∏—è –±–µ–∑ —Å–µ—Ä—å—ë–∑–Ω—ã—Ö —Ç–µ–º.\n"
            "¬´–ò–Ω–æ–≥–¥–∞ –ª—É—á—à–∏–π —à–∞–≥ ‚Äî –º—è–≥–∫–∏–π —à–∞–≥.¬ª"
        ),
    },
    "money": {
        "1": (
            "<b>–û—Ç–≤–µ—Ç:</b> –≥–ª–∞–≤–Ω—ã–π —Å—Ç–æ–ø ‚Äî —Ä–∞—Å—Ñ–æ–∫—É—Å. üìå\n"
            "<b>–®–∞–≥:</b> –æ–¥–∏–Ω –¥–µ–Ω–µ–∂–Ω—ã–π —à–∞–≥ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: –∑–∞–∫—Ä—ã—Ç—å –æ–¥–∏–Ω —Å—á—ë—Ç, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å 3 –æ—Ç–∫–ª–∏–∫–∞, —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è –ø–æ –ø–æ–¥—Ä–∞–±–æ—Ç–∫–µ ‚Äî –¥–æ–≤–µ–¥–∏ –¥–æ –∫–æ–Ω—Ü–∞.\n"
            "¬´–§–æ–∫—É—Å ‚Äî —É—Å–∫–æ—Ä–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞.¬ª"
        ),
        "2": (
            "<b>–û—Ç–≤–µ—Ç:</b> –∑–∞–Ω–∏–∂–µ–Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å. üíº\n"
            "<b>–®–∞–≥:</b> –ø—Ä–∏–±–∞–≤—å +10‚Äì15% –∫ —Ü–µ–Ω–µ/—Å—Ç–∞–≤–∫–µ –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏ –Ω–∞–¥–±–∞–≤–∫—É: ¬´–ì–æ—Ç–æ–≤(–∞) –±—Ä–∞—Ç—å –±–æ–ª—å—à–µ –∑–∞–¥–∞—á, –ø—Ä–æ—à—É –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–ø–ª–∞—Ç—É –¥–æ ___¬ª.\n"
            "¬´–î–µ–Ω—å–≥–∏ –∏–¥—É—Ç —Ç—É–¥–∞, –≥–¥–µ —Å–µ–±—è —Ü–µ–Ω—è—Ç.¬ª"
        ),
        "3": (
            "<b>–û—Ç–≤–µ—Ç:</b> –Ω–µ –≤–∏–¥–Ω–æ —Ç–≤–æ—é –ø–æ–ª—å–∑—É (–¥–µ–ª–æ –Ω–µ –≤ –Ω–∞–≤—ã–∫–∞—Ö). üîé\n"
            "<b>–®–∞–≥:</b> –ø–æ–ø—Ä–æ—Å–∏ —É 2 –ª—é–¥–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å: ¬´–ß—Ç–æ —Å–æ –º–Ω–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ —É–¥–æ–±–Ω–æ? –ß—Ç–æ —è –¥–µ–ª–∞—é –ª—É—á—à–µ –≤—Å–µ–≥–æ?¬ª ‚Äî –¥–æ–±–∞–≤—å —ç—Ç–æ –≤ —Ä–µ–∑—é–º–µ/–¥–∏–∞–ª–æ–≥–∏.\n"
            "¬´–°—Ç–∞–Ω—å –≤–∏–¥–∏–º(–æ–π) —Ç–∞–º, –≥–¥–µ —Ç—ã —É–∂–µ –ø–æ–ª–µ–∑–µ–Ω(–Ω–∞).¬ª"
        ),
        "4": (
            "<b>–û—Ç–≤–µ—Ç:</b> –¥–µ–Ω—å–≥–∏ —É–ø–∏—Ä–∞—é—Ç—Å—è –≤ —Ö–∞–æ—Å. üìí\n"
            "<b>–®–∞–≥:</b> ¬´—Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ 20 –º–∏–Ω—É—Ç¬ª —Å–µ–≥–æ–¥–Ω—è: –≤—ã–ø–∏—Å–∫–∞ –¥–æ—Ö–æ–¥–æ–≤/—Ä–∞—Å—Ö–æ–¥–æ–≤ ‚Üí –æ–¥–∏–Ω –ø–µ—Ä–µ–≤–æ–¥/—Ö–≤–æ—Å—Ç ‚Üí 1 –ø–ª–∞–Ω –Ω–∞ –Ω–µ–¥–µ–ª—é.\n"
            "¬´–ü–æ—Ä—è–¥–æ–∫ ‚Äî —É–≤–∞–∂–µ–Ω–∏–µ –∫ —Å–≤–æ–µ–º—É –ø–æ—Ç–æ–∫—É.¬ª"
        ),
        "5": (
            "<b>–û—Ç–≤–µ—Ç:</b> —Ä–∞—Å—Ç—ë—à—å –≤ –æ–¥–∏–Ω–æ—á–∫—É ‚Äî –ø–æ—Ç–æ–ª–æ–∫ –±–ª–∏–∑–∫–æ. ü§ù\n"
            "<b>–®–∞–≥:</b> –ø—Ä–µ–¥–ª–æ–∂–∏ –∑–Ω–∞–∫–æ–º–æ–º—É(–æ–π) –ø—Ä–æ—Å—Ç–æ–µ –≤–∑–∞–∏–º–æ–≤—ã–≥–æ–¥–Ω–æ–µ –¥–µ–ª–æ: ¬´–î–∞–≤–∞–π –≤–º–µ—Å—Ç–µ –≤–æ–∑—å–º—ë–º –º–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–æ–µ–∫—Ç/—Å–º–µ–Ω—É¬ª –∏–ª–∏ –æ–±–º–µ–Ω –Ω–∞–≤—ã–∫–∞–º–∏.\n"
            "¬´–î–æ—Ö–æ–¥ –ª—é–±–∏—Ç –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞.¬ª"
        ),
    },
    "talent": {
        "1": (
            "<b>–û—Ç–≤–µ—Ç:</b> –æ–±—ä—è—Å–Ω—è–µ—à—å —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–æ—Å—Ç–æ. üí°\n"
            "<b>–®–∞–≥:</b> –≤—ã–±–µ—Ä–∏ –æ–¥–Ω—É —Ç–µ–º—É –∏ –æ–±—ä—è—Å–Ω–∏ –µ—ë –±–ª–∏–∑–∫–æ–º—É –∑–∞ 3‚Äì5 –º–∏–Ω—É—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏; –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–Ω—è–ª(–∞).\n"
            "¬´–ë—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º ‚Äî —Ä–µ–¥–∫–∏–π –¥–∞—Ä.¬ª"
        ),
        "2": (
            "<b>–û—Ç–≤–µ—Ç:</b> —Å–æ–µ–¥–∏–Ω—è–µ—à—å –ª—é–¥–µ–π –∏ –∏–¥–µ–∏. üåâ\n"
            "<b>–®–∞–≥:</b> –ø–æ–∑–Ω–∞–∫–æ–º—å –¥–≤—É—Ö –∑–Ω–∞–∫–æ–º—ã—Ö, –∫–æ—Ç–æ—Ä—ã–º –ø–æ–ª–µ–∑–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è, –∏ –∫—Ä–∞—Ç–∫–æ –Ω–∞–ø–∏—à–∏ ‚Äî —á–µ–º –æ–Ω–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å –¥—Ä—É–≥ –¥—Ä—É–≥—É.\n"
            "¬´–¢–∞–º, –≥–¥–µ —Ç—ã ‚Äî –ø–æ—è–≤–ª—è—é—Ç—Å—è –º–æ—Å—Ç—ã.¬ª"
        ),
        "3": (
            "<b>–û—Ç–≤–µ—Ç:</b> —Ç–æ–Ω–∫–æ–µ —á—É–≤—Å—Ç–≤–æ –≤–∫—É—Å–∞/–Ω—é–∞–Ω—Å–∞. üé®\n"
            "<b>–®–∞–≥:</b> —Å–¥–µ–ª–∞–π ¬´–≤—ã–±–æ—Ä –¥–Ω—è¬ª: –æ–¥–Ω–∞ –≤–µ—â—å/–º—ã—Å–ª—å/–º—É–∑—ã–∫–∞ ‚Äî –∏ 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ø–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ç–µ–±—è.\n"
            "¬´–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚Äî —Å–∏–ª–∞, –∫–æ–≥–¥–∞ —É –Ω–µ—ë –µ—Å—Ç—å —Ñ–æ—Ä–º–∞.¬ª"
        ),
        "4": (
            "<b>–û—Ç–≤–µ—Ç:</b> –≤–∏–¥–∏—à—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ —à–∞–≥–∏. üß≠\n"
            "<b>–®–∞–≥:</b> —Ä–∞—Å–ø–∏—à–∏ –æ–¥–Ω—É —Ü–µ–ª—å –≤ 3 —à–∞–≥–∞ –Ω–∞ 7 –¥–Ω–µ–π (—à–∞–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑–º–µ—Ä–∏–º—ã) –∏ —Å–¥–µ–ª–∞–π –ø–µ—Ä–≤—ã–π —Å–µ–≥–æ–¥–Ω—è.\n"
            "¬´–ü—É—Ç—å –∫–æ—Ä–æ—á–µ, –∫–æ–≥–¥–∞ –≤–∏–¥–µ–Ω –ø–ª–∞–Ω.¬ª"
        ),
        "5": (
            "<b>–û—Ç–≤–µ—Ç:</b> —Å–æ–±–∏—Ä–∞–µ—à—å —Å–º—ã—Å–ª –∏–∑ —Ö–∞–æ—Å–∞. üî¶\n"
            "<b>–®–∞–≥:</b> –≤—ã–±–µ—Ä–∏ –∑–∞–ø—É—Ç–∞–Ω–Ω—É—é —Ç–µ–º—É –∏ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –µ—ë —Å—É—Ç—å –≤ 5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö ‚Äî –¥–ª—è —Å–µ–±—è.\n"
            "¬´–°–º—ã—Å–ª ‚Äî —Å–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —É–º–µ–µ—à—å –≤–∫–ª—é—á–∞—Ç—å.¬ª"
        ),
    },
}

# ‚îÄ‚îÄ –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
KB_MAIN = types.ReplyKeyboardMarkup(resize_keyboard=True)
KB_MAIN.add("–ú–æ—è —Ç–µ–º–∞")
KB_MAIN.add("–û –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏", "–ö–∞–Ω–∞–ª")

def topic_keyboard():
    kb = InlineKeyboardMarkup()
    kb.add(InlineKeyboardButton(TOPIC_LABELS["think"], callback_data="topic:think"))
    kb.add(InlineKeyboardButton(TOPIC_LABELS["money"], callback_data="topic:money"))
    kb.add(InlineKeyboardButton(TOPIC_LABELS["talent"], callback_data="topic:talent"))
    return kb

def card_keyboard(topic_code: str):
    kb = InlineKeyboardMarkup(row_width=3)
    kb.add(
        InlineKeyboardButton("1", callback_data=f"card:{topic_code}:1"),
        InlineKeyboardButton("2", callback_data=f"card:{topic_code}:2"),
        InlineKeyboardButton("3", callback_data=f"card:{topic_code}:3"),
    )
    kb.add(
        InlineKeyboardButton("4", callback_data=f"card:{topic_code}:4"),
        InlineKeyboardButton("5", callback_data=f"card:{topic_code}:5"),
        InlineKeyboardButton("üé≤ –°–ª—É—á–∞–π–Ω–æ", callback_data=f"card:{topic_code}:rnd"),
    )
    return kb

# ‚îÄ‚îÄ –£—á—ë—Ç ¬´1 –∫–∞—Ä—Ç–∞ –≤ 7 –¥–Ω–µ–π¬ª ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
def load_usage():
    if not USAGE_FILE.exists():
        return {}
    try:
        with open(USAGE_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    except Exception:
        return {}

def save_usage(data):
    with open(USAGE_FILE, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

def can_draw(user_id: int) -> bool:
    data = load_usage()
    sid = str(user_id)
    last_iso = data.get(sid)
    if not last_iso:
        return True
    try:
        last_dt = datetime.fromisoformat(last_iso)
    except Exception:
        return True
    return datetime.utcnow() - last_dt >= timedelta(days=7)

def mark_draw(user_id: int):
    data = load_usage()
    data[str(user_id)] = datetime.utcnow().isoformat()
    save_usage(data)

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# –•–µ–Ω–¥–ª–µ—Ä—ã
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
@dp.message_handler(commands=["start"])
async def cmd_start(m: types.Message):
    photo_path = "welcome.jpg"  # –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Ä—è–¥–æ–º —Å bot.py
    try:
        with open(photo_path, "rb") as photo:
            await m.answer_photo(photo, caption=WELCOME, reply_markup=KB_MAIN)
    except FileNotFoundError:
        # –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç
        await m.answer(WELCOME, reply_markup=KB_MAIN)


@dp.message_handler(commands=["help"])
async def cmd_help(m: types.Message):
    await m.answer(HELP_TEXT, disable_web_page_preview=True)

@dp.message_handler(commands=["privacy"])
async def cmd_privacy(m: types.Message):
    await m.answer(PRIVACY_TEXT)

@dp.message_handler(commands=["menu"])
async def cmd_menu(m: types.Message):
    await m.answer("–í—ã–±–µ—Ä–∏ —Ç–µ–º—É:", reply_markup=topic_keyboard())

def _clean(text: str) -> str:
    return (text or "").strip().lower().replace("—ë", "–µ")

@dp.message_handler(lambda m: any(w in _clean(m.text) for w in ["–º–æ—è —Ç–µ–º–∞", "–º–æ—è-—Ç–µ–º–∞", "–º–æ–π –≤—ã–±–æ—Ä", "–≤—ã–±—Ä–∞—Ç—å —Ç–µ–º—É"]))
async def choose_topic(m: types.Message):
    await m.answer("–í—ã–±–µ—Ä–∏ —Ç–µ–º—É:", reply_markup=topic_keyboard())

@dp.message_handler(lambda m: "–∫–∞–Ω–∞–ª" in _clean(m.text))
async def go_channel(m: types.Message):
    await m.answer(f"–ù–∞—à –∫–∞–Ω–∞–ª: {CHANNEL_LINK}", disable_web_page_preview=True)

@dp.message_handler(lambda m: any(w in _clean(m.text) for w in ["–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏", "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è", "–∑–∞–ø–∏—Å—å"]))
async def about_offer(m: types.Message):
    await m.answer(ABOUT_TEXT, disable_web_page_preview=True)

@dp.callback_query_handler(lambda c: c.data.startswith("topic:"))
async def on_topic(c: types.CallbackQuery):
    topic_code = c.data.split(":")[1]
    title = TOPIC_LABELS.get(topic_code, "–¢–µ–º–∞")
    await c.message.edit_text(
        f"<b>{title}</b>\n\n–í—ã–±–µ—Ä–∏ –∫–∞—Ä—Ç—É: 1‚Äì5 –∏–ª–∏ ¬´üé≤ –°–ª—É—á–∞–π–Ω–æ¬ª.",
        reply_markup=card_keyboard(topic_code)
    )
    await c.answer()

@dp.callback_query_handler(lambda c: c.data.startswith("card:"))
async def on_card(c: types.CallbackQuery):
    _, topic_code, pick = c.data.split(":")

    if not can_draw(c.from_user.id):
        await c.answer()
        await c.message.edit_text(LOCK_TEXT, disable_web_page_preview=True)
        return

    if pick == "rnd":
        pick = random.choice(["1", "2", "3", "4", "5"])

    body = TEXTS.get(topic_code, {}).get(pick)
    if not body:
        await c.answer()
        await c.message.edit_text("–£–ø—Å‚Ä¶ —ç—Ç–æ–π –∫–∞—Ä—Ç—ã –ø–æ–∫–∞ –Ω–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥—É—é. üôÇ")
        return

    mark_draw(c.from_user.id)
    reply = body + CTA_TAIL
    await c.answer()
    await c.message.edit_text(reply, disable_web_page_preview=True)

# –§–æ–ª–±—ç–∫: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é
@dp.message_handler(content_types=types.ContentTypes.TEXT)
async def fallback(m: types.Message):
    await m.answer("–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å, –Ω–∞–∂–º–∏ ¬´–º–æ—è —Ç–µ–º–∞¬ª –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É /menu üôÇ", reply_markup=KB_MAIN)

# ‚îÄ‚îÄ –ó–∞–ø—É—Å–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
